<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1064px" preserveAspectRatio="none" style="width:1106px;height:1064px;background:#FFFFFF;" version="1.1" viewBox="0 0 1106 1064" width="1106px" zoomAndPan="magnify"><defs/><g><rect fill="#DDD5F3" height="1045.4375" style="stroke:#181818;stroke-width:0.5;" width="660" x="150.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="114" x="421" y="18.0669">Settlements BC</text><rect fill="none" height="205.0625" style="stroke:#000000;stroke-width:1.5;" width="482.5" x="10" y="120.7266"/><rect fill="none" height="613.0547" style="stroke:#000000;stroke-width:1.5;" width="1090" x="10" y="339.7891"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="71" x2="71" y1="103.7266" y2="969.8438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="225.5" x2="225.5" y1="103.7266" y2="969.8438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="421.5" x2="421.5" y1="103.7266" y2="969.8438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="681.5" x2="681.5" y1="103.7266" y2="969.8438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="772.5" x2="772.5" y1="103.7266" y2="969.8438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="857.5" x2="857.5" y1="103.7266" y2="969.8438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="958.5" x2="958.5" y1="103.7266" y2="969.8438"/><rect fill="#93CEFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103" x="20" y="72.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="27" y="92.4248">Transfers BC</text><rect fill="#93CEFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103" x="20" y="968.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="27" y="988.8389">Transfers BC</text><rect fill="#D0BFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="142" x="154.5" y="56.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="181.5" y="76.1279">Settlements</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="161.5" y="92.4248">Command Handler</text><rect fill="#D0BFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="142" x="154.5" y="968.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="181.5" y="988.8389">Settlements</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="161.5" y="1005.1357">Command Handler</text><rect fill="#D0BFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="122" x="360.5" y="56.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="367.5" y="76.1279">Settlements BC</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="388" y="92.4248">App Logic</text><rect fill="#D0BFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="122" x="360.5" y="968.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="367.5" y="988.8389">Settlements BC</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="388" y="1005.1357">App Logic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="634.5" y="84.1279">Settlements</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="645.5" y="100.4248">Database</text><path d="M663.5,35.1328 C663.5,25.1328 681.5,25.1328 681.5,25.1328 C681.5,25.1328 699.5,25.1328 699.5,35.1328 L699.5,61.1328 C699.5,71.1328 681.5,71.1328 681.5,71.1328 C681.5,71.1328 663.5,71.1328 663.5,61.1328 L663.5,35.1328 " fill="#D0BFFF" style="stroke:#181818;stroke-width:1.5;"/><path d="M663.5,35.1328 C663.5,45.1328 681.5,45.1328 681.5,45.1328 C681.5,45.1328 699.5,45.1328 699.5,35.1328 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="634.5" y="981.8389">Settlements</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="645.5" y="998.1357">Database</text><path d="M663.5,1011.4375 C663.5,1001.4375 681.5,1001.4375 681.5,1001.4375 C681.5,1001.4375 699.5,1001.4375 699.5,1011.4375 L699.5,1037.4375 C699.5,1047.4375 681.5,1047.4375 681.5,1047.4375 C681.5,1047.4375 663.5,1047.4375 663.5,1037.4375 L663.5,1011.4375 " fill="#D0BFFF" style="stroke:#181818;stroke-width:1.5;"/><path d="M663.5,1011.4375 C663.5,1021.4375 681.5,1021.4375 681.5,1021.4375 C681.5,1021.4375 699.5,1021.4375 699.5,1011.4375 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#B19CD7" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="68" x="738.5" y="56.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="746.5" y="76.1279">Ledger</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="745.5" y="92.4248">Adapter</text><rect fill="#B19CD7" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="68" x="738.5" y="968.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="746.5" y="988.8389">Ledger</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="745.5" y="1005.1357">Adapter</text><rect fill="#CC7722" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="816.5" y="56.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="827.5" y="76.1279">Platform</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="823.5" y="92.4248">Config BC</text><rect fill="#CC7722" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="816.5" y="968.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="827.5" y="988.8389">Platform</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="823.5" y="1005.1357">Config BC</text><rect fill="#66A767" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101" x="908.5" y="56.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="916.5" y="76.1279">Accounts &amp;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="915.5" y="92.4248">Balances BC</text><rect fill="#66A767" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101" x="908.5" y="968.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="916.5" y="988.8389">Accounts &amp;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="915.5" y="1005.1357">Balances BC</text><path d="M10,120.7266 L264,120.7266 L264,127.8594 L254,137.8594 L10,137.8594 L10,120.7266 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="205.0625" style="stroke:#000000;stroke-width:1.5;" width="482.5" x="10" y="120.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="209" x="25" y="133.7935">1. Publish Cleared Transfers</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="71.5" x2="113.5" y1="158.9922" y2="158.9922"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="113.5" x2="113.5" y1="158.9922" y2="171.9922"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="72.5" x2="113.5" y1="171.9922" y2="171.9922"/><polygon fill="#181818" points="82.5,167.9922,72.5,171.9922,82.5,175.9922,78.5,171.9922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="78.5" y="153.9263">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="91.5" y="153.9263">Prepare transfer</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="71.5" x2="113.5" y1="216.2578" y2="216.2578"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="113.5" x2="113.5" y1="216.2578" y2="229.2578"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="72.5" x2="113.5" y1="229.2578" y2="229.2578"/><polygon fill="#181818" points="82.5,225.2578,72.5,229.2578,82.5,233.2578,78.5,229.2578" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="78.5" y="203.6255">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="91.5" y="196.0591">Obtain</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="91.5" y="211.1919">settlement model</text><polygon fill="#181818" points="213.5,269.5234,223.5,273.5234,213.5,277.5234,217.5,273.5234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="71.5" x2="219.5" y1="273.5234" y2="273.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="78.5" y="260.8911">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="91.5" y="253.3247">Fulfil transfer &amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="91.5" y="268.4575">publish event</text><polygon fill="#181818" points="409.5,313.7891,419.5,317.7891,409.5,321.7891,413.5,317.7891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="225.5" x2="415.5" y1="317.7891" y2="317.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="232.5" y="305.1567">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="245.5" y="297.5903">Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="245.5" y="312.7231">published event</text><path d="M10,339.7891 L283,339.7891 L283,346.9219 L273,356.9219 L10,356.9219 L10,339.7891 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="613.0547" style="stroke:#000000;stroke-width:1.5;" width="1090" x="10" y="339.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="228" x="25" y="352.856">2. Create Settlement Transfers</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="421.5" x2="463.5" y1="393.1875" y2="393.1875"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="463.5" x2="463.5" y1="393.1875" y2="406.1875"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="422.5" x2="463.5" y1="406.1875" y2="406.1875"/><polygon fill="#181818" points="432.5,402.1875,422.5,406.1875,432.5,410.1875,428.5,406.1875" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="428.5" y="380.5552">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="441.5" y="372.9888">Trigger settlement &amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="441.5" y="388.1216">validate transfer data</text><polygon fill="#181818" points="669.5,431.3203,679.5,435.3203,669.5,439.3203,673.5,435.3203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="421.5" x2="675.5" y1="435.3203" y2="435.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="428.5" y="430.2544">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="441.5" y="430.2544">Lookup settlement config</text><polygon fill="#181818" points="432.5,460.4531,422.5,464.4531,432.5,468.4531,428.5,464.4531" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="845.5,460.4531,855.5,464.4531,845.5,468.4531,849.5,464.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="426.5" x2="851.5" y1="464.4531" y2="464.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="438.5" y="459.3872">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="451.5" y="459.3872">Fetch participant settlement config</text><polygon fill="#181818" points="669.5,489.5859,679.5,493.5859,669.5,497.5859,673.5,493.5859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="421.5" x2="675.5" y1="493.5859" y2="493.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="428.5" y="488.52">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="441.5" y="488.52">Store participant settlement config</text><polygon fill="#181818" points="432.5,518.7188,422.5,522.7188,432.5,526.7188,428.5,522.7188" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="669.5,518.7188,679.5,522.7188,669.5,526.7188,673.5,522.7188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="426.5" x2="675.5" y1="522.7188" y2="522.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="438.5" y="517.6528">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="451.5" y="517.6528">Determine settlement batch</text><polygon fill="#181818" points="760.5,547.8516,770.5,551.8516,760.5,555.8516,764.5,551.8516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="421.5" x2="766.5" y1="551.8516" y2="551.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="428.5" y="546.7856">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="441.5" y="546.7856">Request settlement accounts</text><polygon fill="#181818" points="947,592.1172,957,596.1172,947,600.1172,951,596.1172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="772.5" x2="953" y1="596.1172" y2="596.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="779.5" y="583.4849">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="792.5" y="575.9185">Request settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="792.5" y="591.0513">accounts</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="959" x2="1001" y1="640.3828" y2="640.3828"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1001" x2="1001" y1="640.3828" y2="653.3828"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="960" x2="1001" y1="653.3828" y2="653.3828"/><polygon fill="#181818" points="970,649.3828,960,653.3828,970,657.3828,966,653.3828" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="966" y="627.7505">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="979" y="620.1841">Retrieve / create</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="979" y="635.3169">accounts</text><polygon fill="#181818" points="783.5,693.6484,773.5,697.6484,783.5,701.6484,779.5,697.6484" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="777.5" x2="958" y1="697.6484" y2="697.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="789.5" y="685.0161">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="802.5" y="677.4497">Return settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="802.5" y="692.5825">accounts</text><polygon fill="#181818" points="432.5,722.7813,422.5,726.7813,432.5,730.7813,428.5,726.7813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="426.5" x2="771.5" y1="726.7813" y2="726.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="438.5" y="721.7153">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="460.5" y="721.7153">Return settlement accounts</text><polygon fill="#181818" points="760.5,751.9141,770.5,755.9141,760.5,759.9141,764.5,755.9141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="421.5" x2="766.5" y1="755.9141" y2="755.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="428.5" y="750.8481">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="450.5" y="750.8481">Create settlement transfers</text><polygon fill="#181818" points="783.5,796.1797,773.5,800.1797,783.5,804.1797,779.5,800.1797" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="947,796.1797,957,800.1797,947,804.1797,951,800.1797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="777.5" x2="953" y1="800.1797" y2="800.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="789.5" y="787.5474">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="811.5" y="779.981">Create settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="811.5" y="795.1138">transfers</text><polygon fill="#181818" points="432.5,825.3125,422.5,829.3125,432.5,833.3125,428.5,829.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="426.5" x2="771.5" y1="829.3125" y2="829.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="438.5" y="824.2466">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238" x="460.5" y="824.2466">Confirm settlement transfers created</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="421.5" x2="463.5" y1="858.4453" y2="858.4453"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="463.5" x2="463.5" y1="858.4453" y2="871.4453"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="422.5" x2="463.5" y1="871.4453" y2="871.4453"/><polygon fill="#181818" points="432.5,867.4453,422.5,871.4453,432.5,875.4453,428.5,871.4453" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="428.5" y="853.3794">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="450.5" y="853.3794">Prepare response</text><polygon fill="#181818" points="236.5,911.7109,226.5,915.7109,236.5,919.7109,232.5,915.7109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="230.5" x2="420.5" y1="915.7109" y2="915.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="242.5" y="903.0786">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="264.5" y="895.5122">Return response about</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="264.5" y="910.645">settlement transfers</text><polygon fill="#181818" points="82.5,940.8438,72.5,944.8438,82.5,948.8438,78.5,944.8438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="76.5" x2="224.5" y1="944.8438" y2="944.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="88.5" y="939.7778">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="110.5" y="939.7778">Publish response</text><!--MD5=[49f295f575444dac4cf0ba7a1f1704bb]
@startuml Settle_with_Transfers_BC

'skinparam TitleFontSize 12
'skinparam TitleFontColor #FFFFFF
'skinparam titleBorderRoundCorner 10
'skinparam titleBorderThickness 6
'skinparam titleBorderColor #005B96
'skinparam titleBackgroundColor #005B96
'title Settlement from Transfers BC

participant "Transfers BC" as ext_transfers_bc #93CEFF
/'
note over ext_transfers_bc
    Clear transactions & 
    publish / listen for events
end note
'/

box Settlements BC #DDD5F3
	participant "Settlements \nCommand Handler" as sbc_grpc #D0BFFF
	participant "Settlements BC\nApp Logic" as sbc_app_logic #D0BFFF
	database "Settlements \nDatabase" as sbc_db #D0BFFF
    participant "Ledger \nAdapter" as sbc_adptr #B19CD7
end box

participant "Platform \nConfig BC" as pc_bc #CC7722
participant "Accounts & \nBalances BC" as ab_bc #66A767
'#93CEFF

group 1. Publish Cleared Transfers
autonumber
    ext_transfers_bc - -> ext_transfers_bc : Prepare transfer
    ext_transfers_bc - -> ext_transfers_bc : Obtain \nsettlement model
    ext_transfers_bc -> sbc_grpc : Fulfil transfer & \npublish event
    sbc_grpc - -> sbc_app_logic : Consume \npublished event
end

group 2. Create Settlement Transfers
autonumber
    sbc_app_logic - -> sbc_app_logic: Trigger settlement & \nvalidate transfer data
    sbc_app_logic - -> sbc_db : Lookup settlement config
    sbc_app_logic <-> pc_bc : Fetch participant settlement config
    sbc_app_logic - -> sbc_db : Store participant settlement config
    sbc_app_logic <- -> sbc_db : Determine settlement batch
    sbc_app_logic - -> sbc_adptr : Request settlement accounts
    sbc_adptr -> ab_bc : Request settlement \naccounts
    ab_bc - -> ab_bc : Retrieve / create \naccounts
    ab_bc -> sbc_adptr : Return settlement \naccounts
    sbc_adptr - -> sbc_app_logic : Return settlement accounts
    sbc_app_logic - -> sbc_adptr: Create settlement transfers
    sbc_adptr <-> ab_bc: Create settlement \ntransfers
    sbc_adptr - -> sbc_app_logic: Confirm settlement transfers created
    sbc_app_logic - -> sbc_app_logic: Prepare response
    sbc_app_logic - -> sbc_grpc: Return response about \nsettlement transfers
    sbc_grpc -> ext_transfers_bc: Publish response
end

@enduml 

@startuml Settle_with_Transfers_BC


participant "Transfers BC" as ext_transfers_bc #93CEFF

box Settlements BC #DDD5F3
	participant "Settlements \nCommand Handler" as sbc_grpc #D0BFFF
	participant "Settlements BC\nApp Logic" as sbc_app_logic #D0BFFF
	database "Settlements \nDatabase" as sbc_db #D0BFFF
    participant "Ledger \nAdapter" as sbc_adptr #B19CD7
end box

participant "Platform \nConfig BC" as pc_bc #CC7722
participant "Accounts & \nBalances BC" as ab_bc #66A767

group 1. Publish Cleared Transfers
autonumber
    ext_transfers_bc - -> ext_transfers_bc : Prepare transfer
    ext_transfers_bc - -> ext_transfers_bc : Obtain \nsettlement model
    ext_transfers_bc -> sbc_grpc : Fulfil transfer & \npublish event
    sbc_grpc - -> sbc_app_logic : Consume \npublished event
end

group 2. Create Settlement Transfers
autonumber
    sbc_app_logic - -> sbc_app_logic: Trigger settlement & \nvalidate transfer data
    sbc_app_logic - -> sbc_db : Lookup settlement config
    sbc_app_logic <-> pc_bc : Fetch participant settlement config
    sbc_app_logic - -> sbc_db : Store participant settlement config
    sbc_app_logic <- -> sbc_db : Determine settlement batch
    sbc_app_logic - -> sbc_adptr : Request settlement accounts
    sbc_adptr -> ab_bc : Request settlement \naccounts
    ab_bc - -> ab_bc : Retrieve / create \naccounts
    ab_bc -> sbc_adptr : Return settlement \naccounts
    sbc_adptr - -> sbc_app_logic : Return settlement accounts
    sbc_app_logic - -> sbc_adptr: Create settlement transfers
    sbc_adptr <-> ab_bc: Create settlement \ntransfers
    sbc_adptr - -> sbc_app_logic: Confirm settlement transfers created
    sbc_app_logic - -> sbc_app_logic: Prepare response
    sbc_app_logic - -> sbc_grpc: Return response about \nsettlement transfers
    sbc_grpc -> ext_transfers_bc: Publish response
end

@enduml 

PlantUML version 1.2022.7(Mon Aug 22 19:01:30 SAST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>